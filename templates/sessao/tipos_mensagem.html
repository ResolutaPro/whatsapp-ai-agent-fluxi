{% extends "base.html" %}

{% block title %}Tipos de Mensagem - {{ sessao.nome }} - Fluxi.IA{% endblock %}

{% block content %}
<!-- Page Header -->
<div style="margin-bottom: 2rem;">
    <nav class="breadcrumb" aria-label="breadcrumbs" style="margin-bottom: 0.75rem !important;">
        <ul style="margin-bottom: 0 !important;">
            <li><a href="/sessoes" style="color: #6b7280;"><i class="fas fa-home"></i> Sessões</a></li>
            <li><a href="/sessoes/{{ sessao.id }}/detalhes" style="color: #6b7280;">{{ sessao.nome }}</a></li>
            <li class="is-active"><a style="color: #C75B9B;">Tipos de Mensagem</a></li>
        </ul>
    </nav>
    <h1 class="title is-3" style="margin-bottom: 0.75rem !important; line-height: 1.2;">
        <i class="fas fa-comments" style="color: #ec4899;"></i> Tipos de Mensagem
    </h1>
    <p class="subtitle is-6" style="color: #6b7280; margin-bottom: 0 !important; line-height: 1.4;">
        Configure o comportamento para cada tipo de mensagem na sessão <strong>{{ sessao.nome }}</strong>
    </p>
</div>

<div class="columns">
    <div class="column is-8">
        <form method="POST" action="/sessoes/{{ sessao.id }}/tipos-mensagem/salvar">
            <div class="box" style="margin-bottom: 2rem;">
                <!-- Áudio -->
                <div style="background: #fdf4ff; border-radius: 8px; padding: 1rem; margin-bottom: 1rem; border: 1px solid #f0abfc;">
                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem;">
                        <div style="width: 36px; height: 36px; border-radius: 8px; background: #d946ef; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-microphone" style="color: white;"></i>
                        </div>
                        <strong style="color: #1f2937;">Mensagem de Áudio</strong>
                    </div>
                    <div class="field">
                        <div class="control">
                            <label class="radio"><input type="radio" name="tipo_audio" value="enviar_ia" {% if tipos.audio.acao == 'enviar_ia' %}checked{% endif %}> Transcrever e enviar para IA responder</label>
                        </div>
                        <div class="control">
                            <label class="radio"><input type="radio" name="tipo_audio" value="transcricao_apenas" {% if tipos.audio.acao == 'transcricao_apenas' %}checked{% endif %}> Apenas responder com a transcrição</label>
                        </div>
                        <div class="control">
                            <label class="radio"><input type="radio" name="tipo_audio" value="resposta_fixa" {% if tipos.audio.acao == 'resposta_fixa' %}checked{% endif %} onchange="toggleResposta('audio', this.checked)"> Responder com mensagem fixa</label>
                            <input type="text" class="input" name="tipo_audio_resposta" id="audio_resposta" 
                                   value="{{ tipos.audio.resposta_fixa or '' }}"
                                   placeholder="Digite a resposta..." 
                                   style="{% if tipos.audio.acao != 'resposta_fixa' %}display:none;{% endif %} margin-top: 0.5rem; margin-left: 1.5rem; max-width: 400px;">
                        </div>
                        <div class="control">
                            <label class="radio"><input type="radio" name="tipo_audio" value="ignorar" {% if tipos.audio.acao == 'ignorar' %}checked{% endif %}> Ignorar</label>
                        </div>
                    </div>
                </div>

                <!-- Imagem -->
                <div style="background: #fef3c7; border-radius: 8px; padding: 1rem; margin-bottom: 1rem; border: 1px solid #fcd34d;">
                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem;">
                        <div style="width: 36px; height: 36px; border-radius: 8px; background: #f59e0b; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-image" style="color: white;"></i>
                        </div>
                        <strong style="color: #1f2937;">Mensagem com Imagem</strong>
                    </div>
                    <div class="field">
                        <div class="control">
                            <label class="radio"><input type="radio" name="tipo_imagem" value="enviar_ia" {% if tipos.imagem.acao == 'enviar_ia' %}checked{% endif %}> Enviar para IA responder (visão)</label>
                        </div>
                        <div class="control">
                            <label class="radio"><input type="radio" name="tipo_imagem" value="resposta_fixa" {% if tipos.imagem.acao == 'resposta_fixa' %}checked{% endif %} onchange="toggleResposta('imagem', this.checked)"> Responder com mensagem fixa</label>
                            <input type="text" class="input" name="tipo_imagem_resposta" id="imagem_resposta" 
                                   value="{{ tipos.imagem.resposta_fixa or '' }}"
                                   placeholder="Digite a resposta..." 
                                   style="{% if tipos.imagem.acao != 'resposta_fixa' %}display:none;{% endif %} margin-top: 0.5rem; margin-left: 1.5rem; max-width: 400px;">
                        </div>
                        <div class="control">
                            <label class="radio"><input type="radio" name="tipo_imagem" value="ignorar" {% if tipos.imagem.acao == 'ignorar' %}checked{% endif %}> Ignorar</label>
                        </div>
                    </div>
                </div>

                <!-- Vídeo -->
                <div style="background: #f0f9ff; border-radius: 8px; padding: 1rem; margin-bottom: 1rem; border: 1px solid #7dd3fc;">
                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem;">
                        <div style="width: 36px; height: 36px; border-radius: 8px; background: #0ea5e9; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-video" style="color: white;"></i>
                        </div>
                        <strong style="color: #1f2937;">Mensagem com Vídeo</strong>
                    </div>
                    <div class="field">
                        <div class="control">
                            <label class="radio"><input type="radio" name="tipo_video" value="ignorar" {% if tipos.video.acao == 'ignorar' %}checked{% endif %}> Ignorar</label>
                        </div>
                        <div class="control">
                            <label class="radio"><input type="radio" name="tipo_video" value="resposta_fixa" {% if tipos.video.acao == 'resposta_fixa' %}checked{% endif %} onchange="toggleResposta('video', this.checked)"> Responder com mensagem fixa</label>
                            <input type="text" class="input" name="tipo_video_resposta" id="video_resposta" 
                                   value="{{ tipos.video.resposta_fixa or '' }}"
                                   placeholder="Digite a resposta..." 
                                   style="{% if tipos.video.acao != 'resposta_fixa' %}display:none;{% endif %} margin-top: 0.5rem; margin-left: 1.5rem; max-width: 400px;">
                        </div>
                    </div>
                </div>

                <!-- Sticker -->
                <div style="background: #fef2f2; border-radius: 8px; padding: 1rem; margin-bottom: 1rem; border: 1px solid #fca5a5;">
                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem;">
                        <div style="width: 36px; height: 36px; border-radius: 8px; background: #ef4444; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-sticky-note" style="color: white;"></i>
                        </div>
                        <strong style="color: #1f2937;">Sticker (Figurinha)</strong>
                    </div>
                    <div class="field">
                        <div class="control">
                            <label class="radio"><input type="radio" name="tipo_sticker" value="ignorar" {% if tipos.sticker.acao == 'ignorar' %}checked{% endif %}> Ignorar</label>
                        </div>
                        <div class="control">
                            <label class="radio"><input type="radio" name="tipo_sticker" value="resposta_fixa" {% if tipos.sticker.acao == 'resposta_fixa' %}checked{% endif %} onchange="toggleResposta('sticker', this.checked)"> Responder com mensagem fixa</label>
                            <input type="text" class="input" name="tipo_sticker_resposta" id="sticker_resposta" 
                                   value="{{ tipos.sticker.resposta_fixa or '' }}"
                                   placeholder="Digite a resposta..." 
                                   style="{% if tipos.sticker.acao != 'resposta_fixa' %}display:none;{% endif %} margin-top: 0.5rem; margin-left: 1.5rem; max-width: 400px;">
                        </div>
                    </div>
                </div>

                <!-- Localização -->
                <div style="background: #f0fdf4; border-radius: 8px; padding: 1rem; margin-bottom: 1rem; border: 1px solid #86efac;">
                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem;">
                        <div style="width: 36px; height: 36px; border-radius: 8px; background: #22c55e; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-map-marker-alt" style="color: white;"></i>
                        </div>
                        <strong style="color: #1f2937;">Localização</strong>
                    </div>
                    <div class="field">
                        <div class="control">
                            <label class="radio"><input type="radio" name="tipo_localizacao" value="ignorar" {% if tipos.localizacao.acao == 'ignorar' %}checked{% endif %}> Ignorar</label>
                        </div>
                        <div class="control">
                            <label class="radio"><input type="radio" name="tipo_localizacao" value="enviar_ia" {% if tipos.localizacao.acao == 'enviar_ia' %}checked{% endif %}> Enviar para IA (latitude/longitude)</label>
                        </div>
                        <div class="control">
                            <label class="radio"><input type="radio" name="tipo_localizacao" value="resposta_fixa" {% if tipos.localizacao.acao == 'resposta_fixa' %}checked{% endif %} onchange="toggleResposta('localizacao', this.checked)"> Responder com mensagem fixa</label>
                            <input type="text" class="input" name="tipo_localizacao_resposta" id="localizacao_resposta" 
                                   value="{{ tipos.localizacao.resposta_fixa or '' }}"
                                   placeholder="Digite a resposta..." 
                                   style="{% if tipos.localizacao.acao != 'resposta_fixa' %}display:none;{% endif %} margin-top: 0.5rem; margin-left: 1.5rem; max-width: 400px;">
                        </div>
                    </div>
                </div>

                <!-- Documento -->
                <div style="background: #f5f3ff; border-radius: 8px; padding: 1rem; border: 1px solid #c4b5fd;">
                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem;">
                        <div style="width: 36px; height: 36px; border-radius: 8px; background: #8b5cf6; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-file-alt" style="color: white;"></i>
                        </div>
                        <strong style="color: #1f2937;">Documento</strong>
                    </div>
                    <div class="field">
                        <div class="control">
                            <label class="radio"><input type="radio" name="tipo_documento" value="ignorar" {% if tipos.documento.acao == 'ignorar' %}checked{% endif %}> Ignorar</label>
                        </div>
                        <div class="control">
                            <label class="radio"><input type="radio" name="tipo_documento" value="resposta_fixa" {% if tipos.documento.acao == 'resposta_fixa' %}checked{% endif %} onchange="toggleResposta('documento', this.checked)"> Responder com mensagem fixa</label>
                            <input type="text" class="input" name="tipo_documento_resposta" id="documento_resposta" 
                                   value="{{ tipos.documento.resposta_fixa or '' }}"
                                   placeholder="Digite a resposta..." 
                                   style="{% if tipos.documento.acao != 'resposta_fixa' %}display:none;{% endif %} margin-top: 0.5rem; margin-left: 1.5rem; max-width: 400px;">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Botões -->
            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                <button type="submit" class="button is-primary is-medium" style="background: linear-gradient(135deg, #ec4899 0%, #db2777 100%); border: none; border-radius: 8px; font-weight: 600; padding: 0.75rem 2rem;">
                    <span class="icon"><i class="fas fa-save"></i></span>
                    <span>Salvar Configurações</span>
                </button>
                <a href="/sessoes/{{ sessao.id }}/detalhes" class="button is-medium" style="border-radius: 8px; font-weight: 600; padding: 0.75rem 2rem;">
                    <span class="icon"><i class="fas fa-arrow-left"></i></span>
                    <span>Voltar</span>
                </a>
            </div>
        </form>
    </div>

    <!-- Sidebar de Ajuda -->
    <div class="column is-4">
        <div class="box" style="position: sticky; top: 2rem; background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%); border: 2px solid #e5e7eb;">
            <h3 class="title is-5" style="margin-bottom: 1rem;">
                <i class="fas fa-info-circle" style="color: #3b82f6;"></i> Sobre as Ações
            </h3>
            
            <div style="display: grid; gap: 1rem;">
                <div style="background: white; padding: 1rem; border-radius: 8px; border-left: 3px solid #ef4444;">
                    <p style="font-weight: 600; color: #1f2937; margin-bottom: 0.25rem;">
                        <i class="fas fa-ban"></i> Ignorar
                    </p>
                    <p style="font-size: 0.875rem; color: #6b7280;">
                        Não faz nada com a mensagem recebida.
                    </p>
                </div>

                <div style="background: white; padding: 1rem; border-radius: 8px; border-left: 3px solid #10b981;">
                    <p style="font-weight: 600; color: #1f2937; margin-bottom: 0.25rem;">
                        <i class="fas fa-robot"></i> Enviar para IA
                    </p>
                    <p style="font-size: 0.875rem; color: #6b7280;">
                        Processa a mensagem com o agente ativo e responde.
                    </p>
                </div>

                <div style="background: white; padding: 1rem; border-radius: 8px; border-left: 3px solid #8b5cf6;">
                    <p style="font-weight: 600; color: #1f2937; margin-bottom: 0.25rem;">
                        <i class="fas fa-microphone"></i> Transcrição apenas
                    </p>
                    <p style="font-size: 0.875rem; color: #6b7280;">
                        Para áudios: transcreve e envia a transcrição como resposta.
                    </p>
                </div>

                <div style="background: white; padding: 1rem; border-radius: 8px; border-left: 3px solid #f59e0b;">
                    <p style="font-weight: 600; color: #1f2937; margin-bottom: 0.25rem;">
                        <i class="fas fa-comment"></i> Resposta fixa
                    </p>
                    <p style="font-size: 0.875rem; color: #6b7280;">
                        Envia uma mensagem pré-definida automaticamente.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function toggleResposta(tipo, mostrar) {
    const input = document.getElementById(tipo + '_resposta');
    if (input) {
        input.style.display = mostrar ? 'block' : 'none';
    }
}

// Atualizar visibilidade ao mudar radio
document.querySelectorAll('input[type="radio"]').forEach(radio => {
    radio.addEventListener('change', function() {
        const tipo = this.name.replace('tipo_', '');
        const isRespostaFixa = this.value === 'resposta_fixa';
        toggleResposta(tipo, isRespostaFixa);
    });
});
</script>
{% endblock %}
